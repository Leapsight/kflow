version: "3.4"
networks:
  default:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.57.0/24

services:
  db_host:
    build: db
    ports:
      - 5432:5432
    environment:
      - PROJECT_DIR
      - POSTGRES_PASSWORD
      - POSTGRES_KFLOW_PWD
      - POSTGRES_GRAFANA_PWD
      - PGDATA=/tmp/postgres

  kafka_host:
    image: docker.artifactory.klarna.net/kafka/kafka:2.2.1
    ports:
      - 9094:9094
      - 9093:9093
      - 9092:9092
      - 8081:8081
    environment:
      KAFKA_CREATE_TOPICS: systom_monitor:5

  grafana:
    build: grafana
    depends_on: [db_host]
    ports:
      - 3000:3000
    environment:
      - PROJECT_DIR
      - POSTGRES_GRAFANA_PWD
